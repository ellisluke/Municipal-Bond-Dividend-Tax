<!DOCTYPE html>
<html>
<head>
    <title>Simple Form</title>
    <link href="/css/home.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div id="info-div">
        <h1>Municipal Bond Funds Tax Exemption Calculator</h1>
        <p>This simple calculator lets you calculate your by state tax liability for Municipal Bond Funds that have various municipal bonds within it.</p>
    </div>
    <form method="POST" action="/">
        <!-- State Code Dropdown -->
        <label for="state">State/Territory</label>
        <select id="state" name="state">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
            <!-- Territories -->
            <option value="AS">American Samoa</option>
            <option value="GU">Guam</option>
            <option value="MP">Northern Mariana Islands</option>
            <option value="PR">Puerto Rico</option>
            <option value="VI">U.S. Virgin Islands</option>
        </select>
        <br>

        <!-- Year Dropdown -->
        <label for="year">Year</label>
        <select id="year" name="year">
            <option value="2024">2024</option>
        </select>
        <br>

        <!-- Symbol Input -->
        <label for="symbol">Fund Symbol (e.g. FMNDX)</label>
        <input type="text" id="symbol" name="symbol">
        <br>

        <!-- Dividends Input -->
        <label for="dividends">Dividends Total (for Calendar Year)</label>
        <input type="number" id="dividends" name="dividends" min="0" step=".01">
        <br>
        <button type="submit">Calculate</button>
    </form>
    <% if (data.calculation) { %>
    <div id="results">
        
            <table id="calculation-table">
                <tr>
                    <% data.nums.calculation.forEach(item => { %>
                        <th><%= item[0] %></th> 
                    <% }) %>
                    <th>Dividends</th>
                </tr>
                <tr>
                    <% for (let i = 0; i < data.nums.calculation.length; i++) { 
                        var perc = data.nums.calculation[i][1] * 100 %>
                            
                        <td>
                            <% if (i == 0) { %>
                                (
                            <% } %>
                            <%= perc.toFixed(2) %>%
                            <% if (i == data.nums.calculation.length - 1) { %>
                                )
                            <% } else { %>
                                +
                            <% } %>
                        </td> 
                    <% } %>
                    <td>* <%= data.nums.dividend %></td>
                </tr>
            </table>
            <table id="result-table">
                <tr>
                    <th><%= data.nums.stateCode %> Non-taxable</th>
                    <th><%= data.nums.stateCode %> Taxable</th>
                </tr>
                <tr>
                    <td id="nonTaxCell"><%= data.nums.nonTaxable.toFixed(2) %></td>
                    <td id="taxCell"><%= data.nums.taxable.toFixed(2) %></td>
                </tr>
            </table>
        
    </div>
    <p id="copy-status"></p>
    <% } %>
    <script>
        const copyStatus = document.getElementById('copy-status')
        const defaultMsg = "Click cell to copy"
        copyStatus.innerText = defaultMsg

        const nonTaxCell = document.getElementById('nonTaxCell')
        nonTaxCell.addEventListener('click', () => {
            navigator.clipboard.writeText(nonTaxCell.textContent)
                .then(() => {
                    copyStatus.textContent = "Copied non-taxable!"
                    setTimeout(() => {
                        copyStatus.textContent = defaultMsg
                    }, 2000)
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                })
        })

        const taxCell = document.getElementById('taxCell')
        taxCell.addEventListener('click', () => {
            navigator.clipboard.writeText(taxCell.textContent)
                .then(() => {
                    copyStatus.textContent = "Copied taxable!"
                    setTimeout(() => {
                        copyStatus.textContent = defaultMsg
                    }, 2000)
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                })
        })

    </script>
</body>
</html>
